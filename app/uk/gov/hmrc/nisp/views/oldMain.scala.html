@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.nisp.config.ApplicationConfig
@import uk.gov.hmrc.hmrcfrontend.config.AccountMenuConfig
@import uk.gov.hmrc.hmrcfrontend.views.html.components.implicits.RichAccountMenu
@import uk.gov.hmrc.hmrcfrontend.views.viewmodels.accountmenu.{AccountMenu, SignOut}
@import uk.gov.hmrc.nisp.controllers.routes
@import uk.gov.hmrc.nisp.controllers.auth.AuthenticatedRequest
@import uk.gov.hmrc.ptafrontend.views.html._
@import uk.gov.hmrc.nisp.views.html.components.additionalScripts
@import uk.gov.hmrc.nisp.views.html.includes.attorneyBanner

@this(
  hmrcLayout: HmrcLayout,
  hmrcLanguageSelectHelper: HmrcLanguageSelectHelper,
  hmrcTimeoutDialogHelper: HmrcTimeoutDialogHelper,
  twoThirdsOneThirdMainContent: TwoThirdsOneThirdMainContent,
  twoThirdsMainContent: TwoThirdsMainContent,
  hmrcReportTechnicalIssueHelper: HmrcReportTechnicalIssueHelper,
  govukBackLink: GovukBackLink,
  hmrcReportTechnicalIssue: HmrcReportTechnicalIssue,
  appConfig: ApplicationConfig,
  hmrcAccountMenu: HmrcAccountMenu,
  banner: attorneyBanner,
  ptaHead: PtaHead,
  ptaScripts: PtaScripts,
  additionalScripts: additionalScripts
)(implicit accountMenuConfig: AccountMenuConfig)

@(
  pageTitle: String,
  sidebar: Option[Html] = None,
  showBackLink: Boolean = false,
  sessionExpiredPage: Boolean = false,
  hideNavBar: Boolean = false,
  optCustomLayout: Option[Html => Html] = None,
  extendedTitle: Boolean = true,
  showUrBanner: Boolean = true
)(content: Html)(implicit request: Request[_], messages: Messages)

@headBlock = {
  <meta name="format-detection" content="telephone=no" />
  @hmrcTimeoutDialogHelper(
    signOutUrl =  routes.StatePensionController.signOut.url,
    keepAliveUrl = Some(routes.TimeoutController.keep_alive.url)
  )
  <link rel="stylesheet" href='@controllers.routes.Assets.versioned("stylesheets/nisp.css")'/>
  @ptaHead()
}

@beforeContent = {
  @if(!hideNavBar){
    @hmrcAccountMenu(AccountMenu(
      signOut = SignOut(href = routes.StatePensionController.signOut.url),
      language = if(messages.lang.code == "cy") Cy else En
    ).withUrlsFromConfig())
  }

  @attorneyBanner

  @hmrcLanguageSelectHelper()
}

@attorneyBanner = @{
  request match {
    case auth: AuthenticatedRequest[_] =>
      auth.nispAuthedUser.trustedHelper.map{ helper =>
        banner(helper)
      }
    case _ => None
  }
}

@contentBlock = {
  @content
  <br>
  @hmrcReportTechnicalIssue(ReportTechnicalIssue(
    serviceId = appConfig.contactFormServiceIdentifier,
    language = if(messages.lang.code == "cy") Cy else En,
    referrerUrl = Some(request.uri),
    baseUrl = Some(appConfig.reportAProblemNonJSUrl)
  ))
}

@fullTitle = @{
  pageTitle + " - " + messages("nisp.title.extension") + " - " + messages("nisp.gov-uk")
}


@hmrcLayout(
  pageTitle = Some(if(extendedTitle) {fullTitle} else pageTitle),
  serviceName = Some(messages("nisp.title")),
  serviceUrl = Some(appConfig.serviceUrl),
  isWelshTranslationAvailable = true,
  userResearchBannerUrl = if(showUrBanner) Some(appConfig.urBannerUrl) else None,
  accessibilityStatementUrl = Some(appConfig.accessibilityStatementUrl(request.uri)),
  displayHmrcBanner = false,
  additionalHeadBlock = Some(headBlock),
  beforeContentBlock = Some(beforeContent),
  additionalScriptsBlock  = Some(additionalScripts(Some(ptaScripts))),
  mainContentLayout = Some(sidebar match {
    case Some(sidebarHtml) => twoThirdsOneThirdMainContent(sidebarHtml)
    case None => optCustomLayout.getOrElse(twoThirdsMainContent(_))
})
)(contentBlock)
